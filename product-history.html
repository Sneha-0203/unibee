<!-- Enhanced Product History Page with Pop-up Edit Form, Search, Filter, Sort, and Delete Actions -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product History - Uni Bee</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .navbar { background-color: #333; padding: 14px; display: flex; gap: 20px; }
    .navbar a { color: #fff; text-decoration: none; font-weight: bold; }
    .navbar a:hover { text-decoration: underline; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #f0f0f0; cursor: pointer; }
    .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 20px; background: white; border: 2px solid #ccc; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); }
    .popup input { margin-bottom: 10px; padding: 5px; width: 100%; }
    .popup button { margin: 5px; }
  </style>
</head>
<body>
  <div class="navbar">
    <a href="admin-dashboard.html">Dashboard</a>
    <a href="add-product.html">Add Products</a>
    <a href="product-history.html">Product History</a>
    <a href="logout.html">Logout</a>
  </div>

  <h1>Product History</h1>
  <input type="text" id="search" placeholder="Search by Name or ID" onkeyup="searchProducts()">

  <table id="history-table">
    <thead>
      <tr>
        <th onclick="sortTable(0)">ID</th>
        <th onclick="sortTable(1)">Name</th>
        <th>Description</th>
        <th onclick="sortTable(3)">Price ($)</th>
        <th>Stock</th>
        <th>Supplier</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="editPopup" class="popup">
    <h3>Edit Product</h3>
    <input type="hidden" id="editId">
    <input type="text" id="editName" placeholder="Product Name">
    <input type="text" id="editPrice" placeholder="Price">
    <input type="text" id="editStock" placeholder="Stock">
    <button onclick="saveEdit()">Save</button>
    <button onclick="closePopup()">Cancel</button>
  </div>

  <script>
    let products = [];
    let currentEditId = null;

    async function loadProductHistory() {
      const response = await fetch('product-history.php');
      products = await response.json();
      displayProducts(products);
    }

    function displayProducts(list) {
      const tbody = document.querySelector('#history-table tbody');
      tbody.innerHTML = list.map(p => `
        <tr>
          <td>${p.id}</td><td>${p.name}</td><td>${p.description}</td>
          <td>${p.price}</td><td>${p.stock}</td><td>${p.supplier_name}</td>
          <td>
            <button onclick="openPopup(${p.id})">Edit</button>
            <button onclick="deleteProduct(${p.id})">Delete</button>
          </td>
        </tr>`).join('');
    }

    function openPopup(id) {
      const product = products.find(p => p.id === id);
      currentEditId = id;
      document.getElementById('editId').value = product.id;
      document.getElementById('editName').value = product.name;
      document.getElementById('editPrice').value = product.price;
      document.getElementById('editStock').value = product.stock;
      document.getElementById('editPopup').style.display = 'block';
    }

    function closePopup() {
      document.getElementById('editPopup').style.display = 'none';
    }

    async function saveEdit() {
      const updatedProduct = {
        id: currentEditId,
        name: document.getElementById('editName').value,
        price: document.getElementById('editPrice').value,
        stock: document.getElementById('editStock').value,
      };
      await fetch('update-product.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedProduct)
      });
      closePopup();
      loadProductHistory();
    }

    async function deleteProduct(id) {
      if (confirm('Are you sure you want to delete this product?')) {
        await fetch(`delete-product.php?id=${id}`, { method: 'POST' });
        loadProductHistory();
      }
    }

    function searchProducts() {
      const query = document.getElementById('search').value.toLowerCase();
      const filtered = products.filter(p => 
        p.id.toString().includes(query) ||
        p.name.toLowerCase().includes(query)
      );
      displayProducts(filtered);
    }

    function sortTable(column) {
      products.sort((a, b) => {
        const valA = Object.values(a)[column].toString().toLowerCase();
        const valB = Object.values(b)[column].toString().toLowerCase();
        return valA.localeCompare(valB);
      });
      displayProducts(products);
    }

    window.onload = loadProductHistory;
  </script>
</body>
</html>
